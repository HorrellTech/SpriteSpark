<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpriteSpark - Animation Studio</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/themes.css">
    <link rel="stylesheet" href="css/mobile.css">

    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <script src="https://cdn.jsdelivr.net/npm/gif.js.optimized/dist/gif.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gif.js.optimized/dist/gif.worker.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ccapture.js@1.1.0/build/CCapture.all.min.js"></script>

    <script src="js/sprite-object.js"></script>
    <script src="js/sprite-spark-modals.js"></script>
    <script src="js/ai-drawing.js"></script>
</head>

<body>
    <!-- Menu Bar -->
    <nav class="menubar">
        <div class="menu-item">
            <span>File</span>
            <ul class="dropdown">
                <li><span data-action="new">New</span></li>
                <li><span data-action="open">Open</span></li>
                <li><span data-action="save">Save</span></li>
                <li><span data-action="save-as">Save As</span></li>
                <li class="separator"></li>
                <li><span data-action="export-frame">Export Frame</span></li>
                <li><span data-action="export-animation">Export Animation</span></li>
                <li><span data-action="export-zip">Export Frames as ZIP</span></li>
            </ul>
        </div>
        <div class="menu-item">
            <span>Edit</span>
            <ul class="dropdown">
                <li><span data-action="undo">Undo</span></li>
                <li><span data-action="redo">Redo</span></li>
                <li class="separator"></li>
                <li><span data-action="copy">Copy Selection</span></li>
                <li><span data-action="paste">Paste Selection</span></li>
                <li><span data-action="delete">Delete Selection</span></li>
                <li class="separator"></li>
                <li><span data-action="select-all">Select All</span></li>
                <li><span data-action="deselect">Deselect</span></li>
                <li class="separator"></li>
                <li><span data-action="copy-frame">Copy Frame</span></li>
                <li><span data-action="paste-frame">Paste Frame</span></li>
                <li><span data-action="clear-frame">Clear Frame</span></li>
            </ul>
        </div>
        <div class="menu-item">
            <span>Effects</span>
            <ul class="dropdown">
                <li><span data-action="flip-h">Flip Horizontal</span></li>
                <li><span data-action="flip-v">Flip Vertical</span></li>
                <li><span data-action="rotate">Rotate</span></li>
                <li class="separator"></li>
                <li><span data-action="blur">Blur</span></li>
                <li><span data-action="sharpen">Sharpen</span></li>
                <li><span data-action="hsl">HSL Adjust</span></li>
                <!--li><span data-action="recolor">Recolor</span></li-->
                <li><span data-action="glow">Glow</span></li>
                <li><span data-action="neon">Neon</span></li>
                <li><span data-action="outline">Outline</span></li>
                <li><span data-action="drop-shadow">Drop Shadow</span></li>
                <li><span data-action="emboss">Emboss</span></li>
                <li><span data-action="pixelate">Pixelate</span></li>

                <li><span data-action="contrast">Contrast</span></li>
                <li><span data-action="brightness">Brightness</span></li>
                <li><span data-action="vignette">Vignette</span></li>
                <li><span data-action="fish-eye">Fish Eye</span></li>
            </ul>
        </div>
        <div class="menu-item">
            <span>View</span>
            <ul class="dropdown">
                <li><span data-action="toggle-grid">Toggle Grid</span></li>
                <li><span data-action="toggle-onion-skin">Toggle Onion Skin</span></li>
                <li class="separator"></li>
                <li><span data-action="zoom-in">Zoom In</span></li>
                <li><span data-action="zoom-out">Zoom Out</span></li>
                <li><span data-action="zoom-reset">Zoom Reset</span></li>
            </ul>
        </div>
        <div class="menu-item">
            <span>Theme</span>
            <ul class="dropdown">
                <!-- Themes will be added here through javascript -->
            </ul>
        </div>
    </nav>

    <!-- Toolbar -->
    <div class="toolbar">
        <button class="tool-btn" data-action="new" title="New Project">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 3v10M3 8h10" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
        </button>
        <button class="tool-btn" data-action="open" title="Open Project">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M2 4v8a2 2 0 002 2h8a2 2 0 002-2V6a2 2 0 00-2-2H6L4 2H2z" stroke="currentColor"
                    stroke-width="1.5" fill="none" />
            </svg>
        </button>
        <button class="tool-btn" data-action="save-as" title="Save As">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M2 2v12h12V4l-2-2H2z M4 14V9h8v5H4z M6 2v4h4V2H6z" stroke="currentColor" stroke-width="1"
                    fill="none" />
            </svg>
        </button>

        <div class="toolbar-separator"></div>

        <button class="tool-btn" data-action="export-frame" title="Export Current Frame">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 1v10M4 7l4 4 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
        </button>
        <button class="tool-btn" data-action="export-animation" title="Export Animation">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <rect x="2" y="4" width="12" height="8" rx="2" stroke="currentColor" stroke-width="2" fill="none" />
                <path d="M6 8l2 2 2-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
        </button>

        <div class="toolbar-separator"></div>

        <!-- Panel Toggle Buttons -->
        <div class="panel-toggles">
            <button class="tool-btn panel-toggle-btn" data-panel="left" title="Toggle Left Panel">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <rect x="1" y="2" width="4" height="12" rx="1" stroke="currentColor" fill="currentColor" />
                    <rect x="7" y="2" width="8" height="12" rx="1" stroke="currentColor" fill="none" />
                </svg>
            </button>
            <button class="tool-btn panel-toggle-btn" data-panel="bottom" title="Toggle Bottom Panel">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <rect x="2" y="1" width="12" height="8" rx="1" stroke="currentColor" fill="none" />
                    <rect x="2" y="11" width="12" height="4" rx="1" stroke="currentColor" fill="currentColor" />
                </svg>
            </button>
            <button class="tool-btn panel-toggle-btn" data-panel="right" title="Toggle Right Panel">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <rect x="1" y="2" width="8" height="12" rx="1" stroke="currentColor" fill="none" />
                    <rect x="11" y="2" width="4" height="12" rx="1" stroke="currentColor" fill="currentColor" />
                </svg>
            </button>
        </div>

        <div class="toolbar-separator"></div>

        <div class="zoom-controls">
            <label for="zoomInput" class="zoom-label">Zoom:</label>
            <input type="range" id="zoomInput" min="0.5" max="8" step="0.1" value="1">
            <span id="zoomLevelDisplay">100%</span>
            <!-- Buy Me A Coffee button to the right of zoom controls -->
            <a href="https://www.buymeacoffee.com/SynKrown" target="_blank" class="bmc-button"
                style="margin-left:16px;vertical-align:middle;display:inline-block;">
                <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" height="30"
                    style="vertical-align:middle;">
            </a>
        </div>
    </div>

    <div class="mobile-panel-toggle mobile-left-toggle" id="mobileLeftToggle" title="Show Tools">&#9776;</div>
    <div class="mobile-panel-toggle mobile-right-toggle" id="mobileRightToggle" title="Show Properties">&#9881;</div>
    <div class="mobile-panel-toggle mobile-bottom-toggle" id="mobileBottomToggle" title="Show Frames">&#9635;</div>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Left Panel -->
        <div class="panel left-panel" id="leftPanel">
            <div class="panel-header">
                <span>Tools</span>
                <div class="panel-controls">
                    <!--button class="panel-toggle">−</button-->
                </div>
            </div>

            <!-- Color Picker Section -->
            <div class="panel-section">
                <h3>Colors</h3>
                <div class="color-picker-container">
                    <div class="current-colors">
                        <div class="color-swatch primary-color" id="primaryColor"></div>
                        <div class="color-swatch secondary-color" id="secondaryColor"></div>
                    </div>
                    <input type="color" id="colorPicker" value="#000000">
                    <div class="color-palette" id="colorPalette">
                        <!-- Color swatches will be generated here -->
                    </div>
                </div>
            </div>

            <!-- Tools Section -->
            <div class="panel-section">
                <h3>Drawing Tools</h3>
                <div class="tool-grid">
                    <button class="drawing-tool" data-tool="pointer" title="Pointer/Select Tool">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M3 2l10 4-4 2-2 4L3 2z" stroke="currentColor" stroke-width="1"
                                fill="currentColor" />
                        </svg>
                    </button>
                    <button class="drawing-tool active" data-tool="pen" title="Pen">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path
                                d="M12.146 1.146a.5.5 0 01.708 0l2 2a.5.5 0 010 .708L6.207 12.5 3 13l.5-3.207L12.146 1.146z" />
                        </svg>
                    </button>
                    <button class="drawing-tool" data-tool="eraser" title="Eraser">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path
                                d="M8.086 2.207a2 2 0 01-2.828 0l-.586-.586A2 2 0 002.793.207l10 10a2 2 0 010 2.828L11.5 14.328a2 2 0 01-2.828 0l-6-6a2 2 0 010-2.828l5.414-5.414z" />
                        </svg>
                    </button>
                    <button class="drawing-tool" data-tool="bucket" title="Fill">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path
                                d="M6.5 1A1.5 1.5 0 005 2.5v2.872l-.803-.267A1.5 1.5 0 003 6.632v6.736A1.5 1.5 0 004.5 15h7a1.5 1.5 0 001.5-1.5V6.5a1.5 1.5 0 00-1.5-1.5H11V2.5A1.5 1.5 0 009.5 1h-3z" />
                        </svg>
                    </button>
                    <button class="drawing-tool" data-tool="spline" title="Spline Tool">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M2 12 Q6 8 8 8 Q10 8 14 4" stroke-linecap="round" />
                            <circle cx="2" cy="12" r="1.5" fill="currentColor" />
                            <circle cx="8" cy="8" r="1.5" fill="currentColor" />
                            <circle cx="14" cy="4" r="1.5" fill="currentColor" />
                        </svg>
                    </button>
                    <button class="drawing-tool" data-tool="vector" title="Vector Tool">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M2 2 L8 8 L14 2 M8 8 L14 14" stroke-linecap="round" stroke-linejoin="round" />
                            <circle cx="2" cy="2" r="1.5" fill="currentColor" />
                            <circle cx="8" cy="8" r="1.5" fill="currentColor" />
                            <circle cx="14" cy="2" r="1.5" fill="currentColor" />
                            <circle cx="14" cy="14" r="1.5" fill="currentColor" />
                        </svg>
                    </button>
                    <button class="drawing-tool" data-tool="rectangle-select" title="Rectangle Selection">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-dasharray="3,3">
                            <rect x="2" y="2" width="12" height="12" />
                        </svg>
                    </button>
                    <button class="drawing-tool" data-tool="lasso-select" title="Lasso Selection">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M2 8 Q8 2 14 8 Q10 14 6 10 Q2 12 2 8 Z" stroke-dasharray="3,3" />
                        </svg>
                    </button>
                    <button class="drawing-tool" data-tool="line" title="Line Tool">
                        <svg width="16" height="16">
                            <line x1="2" y1="14" x2="14" y2="2" stroke="currentColor" stroke-width="2" />
                        </svg>
                    </button>
                    <button class="drawing-tool" data-tool="rectangle" title="Rectangle Tool">
                        <svg width="16" height="16">
                            <rect x="2" y="2" width="12" height="12" stroke="currentColor" fill="none"
                                stroke-width="2" />
                        </svg>
                    </button>
                    <button class="drawing-tool" data-tool="ellipse" title="Ellipse Tool">
                        <svg width="16" height="16">
                            <ellipse cx="8" cy="8" rx="6" ry="4" stroke="currentColor" fill="none" stroke-width="2" />
                        </svg>
                    </button>
                    <button class="drawing-tool" data-tool="circle" title="Circle Tool">
                        <svg width="16" height="16">
                            <circle cx="8" cy="8" r="6" stroke="currentColor" fill="none" stroke-width="2" />
                        </svg>
                    </button>
                    <button class="drawing-tool" data-tool="object-tool" title="Object Tool (O)">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <rect x="2" y="2" width="12" height="12" rx="2" stroke="currentColor" stroke-width="2"
                                fill="none" />
                            <circle cx="8" cy="8" r="2" fill="currentColor" />
                            <path d="M8 2v4M8 10v4M2 8h4M10 8h4" stroke="currentColor" stroke-width="1" />
                        </svg>
                    </button>
                    <button class="drawing-tool" data-tool="eyedropper" title="Eyedropper">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path
                                d="M2 2.5a.5.5 0 01.5-.5h3a.5.5 0 010 1H3.707l3.853 3.854a.5.5 0 11-.708.708L3 3.707V5.5a.5.5 0 01-1 0v-3z" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Tool Properties -->
            <div class="panel-section">
                <h3>Tool Properties</h3>
                <div class="tool-properties" id="toolProperties">
                    <div class="property-group">
                        <label>Brush Size: <span id="brushSizeValue">1</span>px</label>
                        <input type="range" id="brushSize" min="1" max="50" value="1" step="1">
                    </div>
                    <div class="property-group">
                        <label>Opacity: <span id="opacityValue">100</span>%</label>
                        <input type="range" id="opacity" min="0" max="100" value="100">
                    </div>

                    <div class="property-group">
                        <label>
                            <input type="checkbox" id="showBrushGhost" checked>
                            Show Brush Ghost
                        </label>
                    </div>

                    <!-- Flood fill options (shown when bucket tool is selected) -->
                    <div class="property-group" id="floodFillOptions" style="display:none;">
                        <h4
                            style="margin: 0 0 var(--spacing-md) 0; color: var(--accent-color); font-size: var(--font-size-small); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                            Fill Tool Options</h4>

                        <label>Tolerance: <span id="floodFillToleranceValue">0</span></label>
                        <input type="range" id="floodFillTolerance" min="0" max="255" value="0">

                        <label style="display: block; margin-top: var(--spacing-md);">
                            <input type="checkbox" id="floodFillDetectAllLayers">
                            Detect all visible layers
                        </label>

                        <div style="margin-top: 8px; font-size: 11px; color: var(--text-secondary);">
                            <strong>Tolerance:</strong> 0 = exact color match, 255 = fill all colors<br>
                            <strong>Detect all layers:</strong> Consider all visible layers when detecting fill area
                        </div>
                    </div>

                    <!-- Spline tool options -->
                    <div class="property-group" id="splineOptions" style="display:none;">
                        <h4
                            style="margin: 0 0 var(--spacing-md) 0; color: var(--accent-color); font-size: var(--font-size-small); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                            Spline Tool Options</h4>

                        <label>Curve Intensity: <span id="splineIntensityValue">50</span>%</label>
                        <input type="range" id="splineIntensity" min="0" max="100" value="50">

                        <label>Spline Type:</label>
                        <select id="splineType">
                            <option value="catmull-rom">Catmull-Rom (Smooth)</option>
                            <option value="bezier">Bezier (Curved)</option>
                            <option value="b-spline">B-Spline (Very Smooth)</option>
                        </select>

                        <label>Curve Smoothing: <span id="splineSmoothingValue">20</span></label>
                        <input type="range" id="splineSmoothing" min="5" max="100" value="20">

                        <label>Tension: <span id="splineTensionValue">50</span>%</label>
                        <input type="range" id="splineTension" min="0" max="100" value="50">

                        <div style="margin-top: 8px;">
                            <label style="display: block;">
                                <input type="checkbox" id="splineShowControlLines" checked>
                                Show Control Lines
                            </label>
                            <label style="display: block;">
                                <input type="checkbox" id="splineShowNumbers" checked>
                                Show Point Numbers
                            </label>
                        </div>

                        <div style="margin-top: 8px; font-size: 11px; color: var(--text-secondary);">
                            <strong>Instructions:</strong><br>
                            • Left click: Add point<br>
                            • Drag: Move point<br>
                            • Right click: Remove point<br>
                            • Click Apply when done
                        </div>
                    </div>
                    <div class="property-group" id="vectorOptions" style="display:none;">
                        <h4
                            style="margin: 0 0 var(--spacing-md) 0; color: var(--accent-color); font-size: var(--font-size-small); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                            Vector Tool Options</h4>

                        <label>Vector Mode:</label>
                        <select id="vectorMode">
                            <option value="path">Path (Connected)</option>
                            <option value="shape">Shape (Closed)</option>
                            <option value="bezier">Bezier Curves</option>
                        </select>

                        <label>Fill:
                            <input type="checkbox" id="vectorFill">
                            Fill Shape
                        </label>

                        <label>Stroke Width: <span id="vectorStrokeValue">2</span>px</label>
                        <input type="range" id="vectorStroke" min="1" max="20" value="2">

                        <div style="margin-top: 8px;">
                            <label style="display: block;">
                                <input type="checkbox" id="vectorShowPoints" checked>
                                Show Control Points
                            </label>
                            <label style="display: block;">
                                <input type="checkbox" id="vectorShowHandles" checked>
                                Show Bezier Handles
                            </label>
                            <label style="display: block;">
                                <input type="checkbox" id="vectorSnapToGrid">
                                Snap to Grid
                            </label>
                        </div>

                        <div style="margin-top: 8px; font-size: 11px; color: var(--text-secondary);">
                            <strong>Instructions:</strong><br>
                            • Left click: Add point<br>
                            • Drag point: Move point<br>
                            • Ctrl+click: Add bezier handle<br>
                            • Right click: Remove point<br>
                            • Enter: Complete vector<br>
                            • Esc: Cancel vector
                        </div>
                    </div>
                    <div class="panel-section" id="objectToolSection" style="display:none;">
                        <h3>Objects</h3>

                        <!-- Object Library -->
                        <div class="object-library">
                            <h4>Object Library</h4>
                            <div class="object-library-controls">
                                <button id="addObjectToLibrary" class="small-btn">Add Object</button>
                                <button id="clearObjectLibrary" class="small-btn">Clear All</button>
                                <input type="file" id="objectImageInput" accept="image/*" style="display: none;">
                            </div>
                            <div id="objectLibraryList" class="object-library-list">
                                <!-- Objects will be populated here -->
                            </div>
                        </div>

                        <!-- Object Properties -->
                        <div class="object-properties" id="objectPropertiesPanel" style="display: none;">
                            <h4>Selected Object</h4>
                            <div class="property-group">
                                <label>Name:</label>
                                <input type="text" id="objectName" placeholder="Object name">
                            </div>
                            <div class="property-group">
                                <label>X Position:</label>
                                <input type="number" id="objectX" step="0.1">
                            </div>
                            <div class="property-group">
                                <label>Y Position:</label>
                                <input type="number" id="objectY" step="0.1">
                            </div>
                            <div class="property-group">
                                <label>Scale:</label>
                                <input type="number" id="objectScale" min="0.1" max="10" step="0.1" value="1">
                            </div>
                            <div class="property-group">
                                <label>Rotation (degrees):</label>
                                <input type="number" id="objectAngle" min="-360" max="360" step="1" value="0">
                            </div>
                            <div class="property-group">
                                <label>Layer:</label>
                                <select id="objectLayer">
                                    <!-- Layer options populated dynamically -->
                                </select>
                            </div>
                            <div class="property-group">
                                <label>
                                    <input type="checkbox" id="objectTween">
                                    Enable Tweening
                                </label>
                            </div>
                            <div class="object-controls">
                                <button id="objectSetKeyframe" class="small-btn">Set Keyframe</button>
                                <button id="objectRemoveKeyframe" class="small-btn">Remove Keyframe</button>
                                <button id="objectCenter" class="small-btn">Center</button>
                                <button id="deleteObject" class="small-btn danger">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Layers Section -->
            <div class="panel-section">
                <h3>Layers</h3>
                <div class="layers-container">
                    <div class="layers-controls">
                        <button class="small-btn" data-action="add-layer" title="Add Layer">+</button>
                        <button class="small-btn" data-action="delete-layer" title="Delete Layer">−</button>
                        <button class="small-btn" data-action="move-layer-up" title="Move Layer Up">↑</button>
                        <button class="small-btn" data-action="move-layer-down" title="Move Layer Down">↓</button>
                    </div>
                    <div class="layers-list" id="layersList">
                        <!-- Example Layer Item (to be dynamically generated) -->
                        <div class="layer-item active" data-layer-id="1">
                            <button class="layer-visibility" data-action="toggle-layer-visibility"
                                title="Toggle Visibility">👁️</button>
                            <span class="layer-name" contenteditable="true">Layer 1</span>
                            <select class="layer-blend-mode" title="Blend Mode">
                                <option value="source-over">Normal</option>
                                <option value="multiply">Multiply</option>
                                <option value="screen">Screen</option>
                                <option value="overlay">Overlay</option>
                                <option value="darken">Darken</option>
                                <option value="lighten">Lighten</option>
                                <option value="color-dodge">Color Dodge</option>
                                <option value="color-burn">Color Burn</option>
                                <option value="hard-light">Hard Light</option>
                                <option value="soft-light">Soft Light</option>
                                <option value="difference">Difference</option>
                                <option value="exclusion">Exclusion</option>
                                <option value="hue">Hue</option>
                                <option value="saturation">Saturation</option>
                                <option value="color">Color</option>
                                <option value="luminosity">Luminosity</option>
                            </select>
                            <input type="range" class="layer-opacity" min="0" max="100" value="100" title="Opacity">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Canvas Area -->
        <div class="canvas-container" id="canvasContainer">
            <div class="canvas-wrapper">
                <canvas id="mainCanvas" width="320" height="240"></canvas>
                <canvas id="gridCanvas" width="320" height="240"></canvas>
                <canvas id="ghostCanvas" width="320" height="240"></canvas>
            </div>
        </div>

        <!-- Right Panel -->
        <div class="panel right-panel" id="rightPanel">
            <div class="panel-header">
                <span>Properties</span>
                <div class="panel-controls">
                    <!--button class="panel-toggle">−</button-->
                </div>
            </div>

            <!-- Animation Controls -->
            <div class="panel-section">
                <h3>Playback</h3>
                <div class="animation-controls">
                    <label>FPS: <input type="number" id="fpsInput" value="12" min="1" max="60"></label>
                    <label>
                        <input type="checkbox" id="loopAnimation" checked> Loop
                    </label>
                    <label>
                        <input type="checkbox" id="animateCanvasFrames">
                        Animate Canvas Frames
                    </label>
                </div>
            </div>

            <div class="panel-section">
                <h3>Drawing Options</h3>
                <div class="drawing-options">
                    <label>
                        <input type="checkbox" id="pixelPerfectCheckbox" checked> Clean Pixels
                    </label>
                    <label>
                        <input type="checkbox" id="pixelDrawingCheckbox" checked> Pixel Perfect Drawing
                    </label>
                    <!--label>
                        <input type="checkbox" id="pixelEdgeCorrectionCheckbox"> Pixel Corner Correction
                    </label-->
                    <label>
                        <input type="checkbox" id="stylusPressureCheckbox">
                        Stylus Pressure for Brush Size
                    </label>

                    <div class="option-group">
                        <label class="option-label">Mirroring</label>
                        <select id="mirrorMode">
                            <option value="none">None</option>
                            <option value="horizontal">Horizontal</option>
                            <option value="vertical">Vertical</option>
                            <option value="diagonal-tb">Diagonal Top to Bottom</option>
                            <option value="diagonal-bt">Diagonal Bottom to Top</option>
                            <option value="horizontal-vertical">Horizontal and Vertical</option>
                            <option value="both-diagonals">Both Diagonals</option>
                            <option value="all">Diagonals, Horizontal and Vertical</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Onion Skin Controls -->
            <div class="panel-section">
                <h3>Onion Skin</h3>
                <div class="animation-controls">
                    <label>
                        <input type="checkbox" id="onionSkinCheckbox"> Enable Onion Skin
                    </label>
                    <label>
                        Frames: <input type="number" id="onionSkinFrames" value="1" min="1" max="10"
                            style="width:50px;">
                    </label>
                </div>
            </div>

            <!-- Live Preview Section -->
            <div class="panel-section">
                <h3>Live Preview</h3>
                <div class="live-preview-controls">
                    <label>
                        <input type="checkbox" id="enablePreview" checked> Enable
                    </label>
                </div>
                <div class="live-preview-wrapper">
                    <canvas id="livePreviewCanvas" width="240" height="180"></canvas>
                </div>
            </div>

            <!-- Canvas Size Section -->
            <div class="panel-section">
                <h3>Canvas Size</h3>
                <div class="canvas-size-controls">
                    <div class="property-group">
                        <label for="canvasWidth">Width:</label>
                        <input type="number" id="canvasWidth" value="320" min="1">
                    </div>
                    <div class="property-group">
                        <label for="canvasHeight">Height:</label>
                        <input type="number" id="canvasHeight" value="240" min="1">
                    </div>
                    <div class="property-group">
                        <label for="resizeMethod">Resize Method:</label>
                        <select id="resizeMethod">
                            <option value="stretch">Stretch to fit</option>
                            <option value="fit">Fit (keep aspect)</option>
                            <option value="crop">Crop to fill</option>
                        </select>
                    </div>
                    <div class="property-group" id="resizePlacementGroup" style="display:none;">
                        <!-- Show when method is 'fit' or 'crop' -->
                        <label>Placement:</label>
                        <div class="placement-grid">
                            <button data-placement="top-left">↖</button>
                            <button data-placement="top-center">↑</button>
                            <button data-placement="top-right">↗</button>
                            <button data-placement="center-left">←</button>
                            <button data-placement="center">·</button>
                            <button data-placement="center-right">→</button>
                            <button data-placement="bottom-left">↙</button>
                            <button data-placement="bottom-center">↓</button>
                            <button data-placement="bottom-right">↘</button>
                        </div>
                    </div>
                    <button class="small-btn" data-action="apply-canvas-size">Apply</button>
                </div>
            </div>

            <div class="panel-section">
                <h3>AI Drawing</h3>
                <div class="ai-drawing-controls">
                    <div class="property-group">
                        <label for="aiPrompt">Describe what to draw:</label>
                        <textarea id="aiPrompt" placeholder="e.g., a simple house, a cat, a sword"></textarea>
                    </div>
                    <!--div class="property-group">
                        <label>Canvas Size for AI:</label>
                        <select id="aiCanvasSize">
                            <option value="16">16x16 (Tiny)</option>
                            <option value="32" selected>32x32 (Small)</option>
                            <option value="64">64x64 (Medium)</option>
                            <option value="128">128x128 (Large)</option>
                        </select>
                    </div-->
                    <div class="property-group">
                        <label>Art Style:</label>
                        <select id="aiArtStyle">
                            <option value="pixel-art">Pixel Art</option>
                            <option value="simple-drawing">Simple Drawing</option>
                            <option value="line-art">Line Art</option>
                            <option value="minimalist">Minimalist</option>
                            <!--option value="realistic">Realistic</option-->
                        </select>
                    </div>
                    <button id="generateAIArt" class="small-btn">Generate AI Art</button>
                    <button id="setApiKey" class="small-btn">Set API Key</button>
                </div>

                <div class="property-group">
                    <h3>AI Animation</h3>
                    <label>
                        Animation Description:
                        <input type="text" id="aiAnimationPrompt"
                            placeholder="e.g., bouncing ball, walking character, spinning star">
                    </label>
                    <label>
                        Frame Count:
                        <input type="number" id="aiAnimationFrames" value="8" min="2" max="24" step="1">
                        <small>2-24 frames</small>
                    </label>
                    <label>
                        Animation Style:
                        <select id="aiAnimationStyle">
                            <option value="cartoon">Cartoon</option>
                            <option value="realistic">Realistic</option>
                            <option value="pixel">Pixel Art</option>
                            <option value="sketch">Sketch</option>
                        </select>
                    </label>
                    <button id="generateAIAnimation" class="tool-btn">Generate AI Animation</button>
                    <small>Generates multiple frames automatically</small>
                </div>
            </div>
            <div id="codeDrawingGroup" class="panel-group">
                <div class="panel-group-title">
                    Code Drawing
                    <button id="openCodeModalBtn" title="Open in Modal" style="float:right;">&#x26F6;</button>
                </div>
                <textarea id="codeDrawingTextarea" rows="8" style="width:100%;font-family:monospace;resize:vertical;">// Example: Draw a house
ctx.fillStyle = '#8B4513';
ctx.fillRect(60, 120, 80, 60); // House base
ctx.fillStyle = '#FF0000';
ctx.beginPath();
ctx.moveTo(60, 120);
ctx.lineTo(100, 80);
ctx.lineTo(140, 120);
ctx.closePath();
ctx.fill(); // Roof
            </textarea>
                <button id="applyCodeDrawingBtn" style="margin-top:6px;">Apply Code</button>
            </div>
        </div>

        <div class="bottom-panel" id="bottomPanel">
            <div class="bottom-panel-header">
                <div class="frames-controls">
                    <button class="small-btn" data-action="add-frame" title="Add Frame">+</button>
                    <button class="small-btn" data-action="insert-frame" title="Insert Frame">⇤</button>
                    <button class="small-btn" data-action="delete-frame" title="Delete Frame">−</button>
                    <button class="small-btn" data-action="duplicate-frame" title="Duplicate Frame">⧉</button>
                    <button class="small-btn" data-action="move-frame-up" title="Move Frame Up">↑</button>
                    <button class="small-btn" data-action="move-frame-down" title="Move Frame Down">↓</button>
                </div>
                <span style="margin-left: 30%; font-weight: 600;">Frames</span>
                <div class="frame-size-controls">
                    <label>View:
                        <select id="frameThumbSize">
                            <option value="simple">Simple</option>
                            <option value="small">Small</option>
                            <option value="medium" selected>Medium</option>
                            <option value="large">Large</option>
                        </select>
                    </label>
                </div>
            </div>
            <div class="frames-list-vertical" id="framesList">
                <!-- Frames will be rendered here vertically -->
            </div>
        </div>
    </div>

    <!--div class="resize-handle bottom-resize" id="bottomResize"></div-->

    <!-- Resize Handles -->
    <div class="resize-handle left-resize" data-panel="left"></div>
    <div class="resize-handle right-resize" data-panel="right"></div>

    <!-- Hidden File Input -->
    <input type="file" id="fileInput" accept=".json,.png,.jpg,.jpeg" style="display: none;">

    <!-- Code Drawing Modal (hidden by default) -->
    <div id="codeDrawingModal" class="modal" style="display:none;">
        <div class="modal-content" style="min-width:400px;max-width:90vw;">
            <div style="display:flex;justify-content:space-between;align-items:center;">
                <h2 style="margin:0;">Code Drawing</h2>
                <button id="closeCodeModalBtn" title="Close" style="font-size:18px;">&times;</button>
            </div>
            <textarea id="codeDrawingModalTextarea" rows="16" style="width:100%;font-family:monospace;resize:vertical;"></textarea>
            <div style="margin-top:10px;display:flex;justify-content:space-between;">
                <button id="applyCodeDrawingModalBtn" class="accent">Apply Code</button>
                <button id="backToPanelBtn">Back to Panel</button>
            </div>
        </div>
    </div>

    <div id="exportModal" class="modal hidden">
        <div class="modal-content">
            <h2>Export Animation</h2>
            <label for="exportFormat">Format:</label>
            <select id="exportFormat">
                <option value="gif">GIF</option>
                <option value="webm">WebM</option>
                <option value="mp4">MP4</option>
                <option value="png-sequence">PNG Sequence Zip File</option>
            </select>
            <label for="exportName">File Name:</label>
            <input type="text" id="exportName" placeholder="animation">
            <div class="modal-actions">
                <button id="exportConfirm" class="modal-btn accent">Export</button>
                <button id="exportCancel" class="modal-btn">Cancel</button>
            </div>
        </div>
    </div>

    <div id="exportLoadingModal" class="modal hidden">
        <div class="modal-content">
            <h2>Exporting Animation...</h2>
            <div id="exportProgressText" style="margin-bottom:12px;">Preparing...</div>
            <div class="progress-bar-bg">
                <div id="exportProgressBar" class="progress-bar"></div>
            </div>
            <button id="exportLoadingCancel" class="modal-btn" style="margin-top:18px;">Cancel</button>
        </div>
    </div>

    <script src="js/sprite-spark.js"></script>
</body>

</html>